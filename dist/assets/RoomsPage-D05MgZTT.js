const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CWgw_Ts5.js","assets/index-Bg5f1udt.css"])))=>i.map(i=>d[i]);
import{c as re,e as ve,d as Gt,u as ye,r as a,I as ue,i as ee,J as pe,_ as Yt,h as be,K as Zt,M as fe,N as Xt,O as Qt,s as es,w as je,Q as Qe,S as ts,T as ss,U as rs,V as ns,o as Q,j as e,B as as,p as et,q as os,W as is,C as ne,Y as ae,P as te,Z as cs,t as Y,D as ls,$ as ot,a0 as ds,F as us,a as oe,a1 as ms,a2 as Ne,R as He,a3 as fs}from"./index-CWgw_Ts5.js";import hs from"./CreateRoomPage-B9nwTkq6.js";import{V as Ce,d as it,e as ps,f as gs,h as xs,u as vs,R as ys,c as ws,C as bs,g as js,i as Ns,D as Ss}from"./DashboardLayout-BhgelqLG.js";import{B as $}from"./button-CcjTP62G.js";import{B as ct}from"./badge-C9UY-Rnr.js";import{I as Ge}from"./input-rGQp_Yl5.js";import{u as Ye}from"./use-toast-DBaDvaQK.js";import{A as Cs}from"./arrow-left-FVbxGo1R.js";import{P as Rs}from"./phone-B9oNUqqs.js";import{U as Re,e as Ps}from"./enhanced-practice-service-BNFGFTJx.js";import{C as ge}from"./card-BFUmA-gF.js";import{L as Le}from"./label-C7e2Xntc.js";import{u as ks,a as Ze}from"./index-DUESD09M.js";import{P as tt}from"./plus-C_ZeD9qF.js";import{G as st}from"./globe-CL3V9On-.js";import{L as Ts}from"./lock-hYWKwE50.js";import"./logo-CmdS9hhj.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],lt=re("ChevronDown",Es);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ms=re("ChevronUp",Is);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],As=re("Copy",_s);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],dt=re("Crown",Os);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Ls=re("Key",Ds);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Bs=re("LoaderCircle",Vs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],Ve=re("MessageSquare",Hs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],Pe=re("MicOff",$s);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],ke=re("Mic",zs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Us=re("Send",Fs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Te=re("VideoOff",Ks),Ws={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.stunprotocol.org:3478"}],iceCandidatePoolSize:15,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",iceTransportPolicy:"all"};function qs(t,n){const{user:s,firebaseUser:r}=ve(),{toast:o}=Gt(),u=ye(),[d,c]=a.useState([]),[h,x]=a.useState(!0),R=a.useRef(!1),y=8,P=a.useRef(new Map),_=a.useRef(new Map);a.useEffect(()=>{if(h&&t&&r&&!R.current){const f=setTimeout(()=>{h&&!R.current&&(x(!1),o({title:"Room Ready",description:"You can now interact with the room. Connection may still be establishing in the background."}))},8e3);return()=>clearTimeout(f)}},[h,t,r,o]),a.useEffect(()=>{const f=setInterval(()=>{const C=Date.now(),l=3e4;for(const[m,i]of P.current.entries())if(C-i.lastActivity>l&&i.quality!=="failed"){P.current.set(m,{...i,quality:"poor"});const b=N.current.get(m);b&&b.connectionState==="connected"&&b.restartIce()}const g=6e4;for(const[m,i]of P.current.entries())if(i.quality==="failed"&&C-i.lastActivity>g){P.current.delete(m),_.current.delete(m);const b=N.current.get(m);b&&(b.close(),N.current.delete(m))}},1e4);return()=>clearInterval(f)},[]);const N=a.useRef(new Map),v=a.useRef([]),w=a.useRef(null),S=a.useRef(!1),j=a.useRef(!1),E=d.find(f=>f.uid===r?.uid);a.useEffect(()=>{const f=setInterval(()=>{c(C=>C.map(l=>{if(!l.stream)return{...l,isSpeaking:!1};let g=!1;try{if(l.stream.getAudioTracks().length>0){const i=new(window.AudioContext||window.webkitAudioContext),b=i.createAnalyser(),k=i.createMediaStreamSource(l.stream);k.connect(b);const M=new Uint8Array(b.frequencyBinCount);b.getByteFrequencyData(M),g=M.reduce((B,H)=>B+H,0)/M.length>20,k.disconnect(),b.disconnect(),i.close()}}catch{}return{...l,isSpeaking:g}}))},1e3);return()=>clearInterval(f)},[d]);const W=a.useCallback(async()=>{if(!r||S.current)return;S.current=!0,n?.getTracks().forEach(l=>l.stop()),w.current?.getTracks().forEach(l=>l.stop()),v.current.forEach(l=>l()),v.current=[];const f=[],C=ue(ee,"rooms",t,"signaling");N.current.forEach((l,g)=>{const m={type:"participant-left",sender:r.uid,recipient:g,payload:{},createdAt:fe()};f.push(pe(C,m)),l.close()}),await Promise.all(f),N.current.clear();try{const{roomsService:l}=await Yt(async()=>{const{roomsService:g}=await import("./index-CWgw_Ts5.js").then(m=>m.ac);return{roomsService:g}},__vite__mapDeps([0,1]));await l.leaveRoom(t,r.uid)}catch{const g=be(ee,"rooms",t,"participants",r.uid);try{await Zt(g)}catch{}}u("/rooms")},[t,r,n,u]),L=a.useCallback(f=>{if(!r||!n)return null;if(N.current.has(f))return N.current.get(f);const C=new RTCPeerConnection(Ws);N.current.set(f,C);const g=d.find(m=>m.uid===r.uid)?.isSharingScreen&&w.current?w.current:n;return g.getTracks().forEach(m=>{try{if(m.kind==="video"){if(m.enabled=E?.isCameraOn??!0,d.length>4){const b=m;if(b.getSettings){const k=b.getSettings()}}}else m.kind==="audio"&&(m.enabled=!(E?.isMuted??!1));C.addTrack(m,g)}catch{}}),C.ontrack=m=>{const i=m.streams[0];i&&i.getTracks().length>0&&(i.getVideoTracks(),i.getAudioTracks(),c(b=>{const k=b.map(M=>M.uid===f?{...M,stream:i}:M);return k.find(M=>M.uid===f)||k.push({uid:f,name:`User ${f.slice(0,6)}`,avatarUrl:"",isMuted:!1,isCameraOn:!0,isSharingScreen:!1,stream:i}),k}))},C.onicecandidate=m=>{if(m.candidate&&r){const i=ue(ee,"rooms",t,"signaling"),b={type:"iceCandidate",sender:r.uid,recipient:f,payload:m.candidate.toJSON(),createdAt:fe()};pe(i,b)}},C.onconnectionstatechange=()=>{const m=Date.now();if(C.connectionState==="connected")P.current.set(f,{lastActivity:m,quality:"good"}),_.current.delete(f);else if(C.connectionState==="connecting")P.current.set(f,{lastActivity:m,quality:"poor"});else if(["disconnected","failed","closed"].includes(C.connectionState)){P.current.set(f,{lastActivity:m,quality:"failed"});const i=_.current.get(f)||0;i<3&&d.length<=y?(_.current.set(f,i+1),setTimeout(()=>{N.current.has(f)&&(N.current.get(f)?.close(),N.current.delete(f)),d.find(k=>k.uid===f)&&L(f)},Math.min(1e3*Math.pow(2,i),5e3))):(N.current.get(f)?.close(),N.current.delete(f),c(b=>b.filter(k=>k.uid!==f)))}},C.oniceconnectionstatechange=()=>{},C},[r,n,t,s.name,s.avatarUrl,d]),J=a.useCallback(async f=>{if(!r||!n)return;const C=f.filter(g=>g.uid!==r.uid);if(C.length>y){const g=C.sort((m,i)=>{if(m.isHost&&!i.isHost)return-1;if(!m.isHost&&i.isHost)return 1;const b=P.current.get(m.uid)?.quality||"poor",k=P.current.get(i.uid)?.quality||"poor",M={good:3,poor:2,failed:1};return M[k]-M[b]}).slice(0,y);for(const m of g)await V(m,f)}else for(const g of C)await V(g,f)},[r,n,t,s.name,s.avatarUrl,L,y,P]),V=async(f,C)=>{if(!N.current.has(f.uid)){const l=L(f.uid);l&&l.signalingState==="stable"&&setTimeout(async()=>{try{const g=await l.createOffer();await l.setLocalDescription(g);const m=C.find(M=>M.uid===r?.uid),i={uid:r.uid,name:s.name||"Anonymous",avatarUrl:s.avatarUrl||"",isMuted:!n.getAudioTracks()[0]?.enabled,isCameraOn:n.getVideoTracks()[0]?.enabled,isSharingScreen:m?.isSharingScreen??!1},b={type:"offer",sender:r.uid,recipient:f.uid,payload:{offer:l.localDescription.toJSON(),participantData:i},createdAt:fe()},k=ue(ee,"rooms",t,"signaling");await pe(k,b)}catch{}},200)}},F=a.useCallback(async()=>{if(!r||!n)return;const f=ue(ee,"rooms",t,"participants"),C=await Xt(f),l=[];C.forEach(g=>{const m=g.data(),i={uid:m.uid||m.userId,name:m.name||m.userName,avatarUrl:m.avatarUrl||"",isMuted:m.isMuted??!m.micEnabled,isCameraOn:m.isCameraOn??m.cameraEnabled,isSharingScreen:m.isSharingScreen??!1};i.uid!==r.uid&&l.push(i)}),await J(l)},[r,n,t,J]);a.useEffect(()=>{if(!r||!s.name||!t||!n||j.current||R.current)return;j.current=!0;const f={uid:r.uid,name:s.name||"Anonymous",avatarUrl:s.avatarUrl||"",isMuted:!n.getAudioTracks()[0]?.enabled,isCameraOn:n.getVideoTracks()[0]?.enabled,isSharingScreen:!1,stream:n};c([f]);const C=()=>{if(!r)return null;const i=ue(ee,"rooms",t,"signaling"),b=ts(i,ss("recipient","==",r.uid));return Qe(b,async M=>{if(S.current)return;const U=rs(ee);for(const B of M.docChanges())if(B.type==="added"){const H=B.doc.data(),A=H.sender;try{if(H.type==="participant-left"){N.current.get(A)?.close(),N.current.delete(A),c(p=>p.filter(I=>I.uid!==A)),U.delete(B.doc.ref);continue}const T=L(A);if(!T)continue;if(H.type==="offer"){const p=H.payload.participantData;c(D=>D.some(O=>O.uid===A)?D.map(O=>O.uid===A?{...O,...p}:O):[...D,p]);const I=r.uid>A;if(T.signalingState!=="stable"&&!I)continue;try{await T.setRemoteDescription(new RTCSessionDescription(H.payload.offer));const D=await T.createAnswer();await T.setLocalDescription(D);const O={type:"answer",sender:r.uid,recipient:A,payload:T.localDescription.toJSON(),createdAt:fe()};await pe(i,O)}catch{}}else if(H.type==="answer")try{T.signalingState==="have-local-offer"&&await T.setRemoteDescription(new RTCSessionDescription(H.payload))}catch{}else if(H.type==="iceCandidate")try{T.remoteDescription&&await T.addIceCandidate(new RTCIceCandidate(H.payload))}catch{}}catch{}finally{U.delete(B.doc.ref)}}M.empty||await U.commit().catch(B=>{})},M=>{})},l=()=>{if(!r)return null;const i=ue(ee,"rooms",t,"participants");return Qe(i,k=>{if(S.current)return;const M=new Set(d.map(A=>A.uid)),U=new Set,B=[];k.forEach(A=>{const T=A.data(),p=T.uid||T.userId;p&&(T.uid=p,!T.name&&T.userName&&(T.name=T.userName),B.push(T),U.add(p))}),Array.from(M).filter(A=>!U.has(A)).forEach(A=>{const T=N.current.get(A);T&&(T.close(),N.current.delete(A))}),c(A=>{const T=[];return B.forEach(p=>{const I=A.find(D=>D.uid===p.uid);I?T.push({...p,stream:I.stream}):T.push(p)}),A.forEach(p=>{T.find(I=>I.uid===p.uid)||T.push(p)}),J(T),setTimeout(()=>{J(T)},1e3),T}),k.docChanges().forEach(async A=>{const T=A.doc.data(),p=T.uid||T.userId;if(p&&p!==r.uid)if(A.type==="added"){const I=L(p);I&&setTimeout(async()=>{if(I.signalingState==="stable")try{const D=await I.createOffer();await I.setLocalDescription(D);const O={uid:r.uid,name:s.name||"Anonymous",avatarUrl:s.avatarUrl||"",isMuted:!n.getAudioTracks()[0]?.enabled,isCameraOn:n.getVideoTracks()[0]?.enabled,isSharingScreen:E?.isSharingScreen??!1},z={type:"offer",sender:r.uid,recipient:p,payload:{offer:I.localDescription.toJSON(),participantData:O},createdAt:fe()},K=ue(ee,"rooms",t,"signaling");await pe(K,z)}catch{}},100)}else A.type==="removed"?(N.current.get(p)?.close(),N.current.delete(p),c(I=>I.filter(D=>D.uid!==p))):A.type==="modified"&&c(I=>I.map(D=>D.uid===p?{...D,...T}:D))})})};(async()=>{try{const i=be(ee,"rooms",t,"participants",r.uid);(await Qt(i)).exists()?await je(i,{name:f.name,userName:f.name,avatarUrl:f.avatarUrl,isMuted:f.isMuted,isCameraOn:f.isCameraOn,isSharingScreen:f.isSharingScreen,micEnabled:!f.isMuted,cameraEnabled:f.isCameraOn}):await es(i,{uid:f.uid,userId:f.uid,name:f.name,userName:f.name,avatarUrl:f.avatarUrl,isMuted:f.isMuted,isCameraOn:f.isCameraOn,isSharingScreen:f.isSharingScreen,isHost:!1,micEnabled:!f.isMuted,cameraEnabled:f.isCameraOn,joinedAt:fe()});const k=l();k&&v.current.push(k);const M=C();M&&v.current.push(M),R.current=!0,x(!1),setTimeout(()=>{F()},2e3);const U=setInterval(()=>{c(B=>(B.filter(A=>A.uid!==r.uid&&!A.stream).length>0&&F(),B))},5e3);return()=>{clearInterval(U)}}catch{o({variant:"destructive",title:"Connection Error",description:"Failed to join the room. Please try again."}),R.current=!0,x(!1)}})();const m=()=>{W()};return window.addEventListener("beforeunload",m),()=>{window.removeEventListener("beforeunload",m),(!r||!t)&&(R.current=!1,j.current=!1,W())}},[r,s.name,t,n]);const G=async(f,C)=>{if(!r||!n)return;const l=E?.isSharingScreen??!1,g=l&&f==="audio"&&w.current?w.current:n,m=f==="audio"?g.getAudioTracks()[0]:n.getVideoTracks()[0];if(!m||l&&f==="video")return;const i=!m.enabled;m.enabled=i;const b=!n.getAudioTracks()[0]?.enabled,k=n.getVideoTracks()[0]?.enabled;c(U=>U.map(B=>B.uid===r.uid?{...B,isMuted:b,isCameraOn:k}:B));const M=be(ee,"rooms",t,"participants",r.uid);await je(M,{isMuted:b,isCameraOn:k,micEnabled:!b,cameraEnabled:k}).catch(U=>{})},q=()=>G("audio"),Z=()=>G("video"),X=async()=>{if(!r||!n)return;const f=E?.isSharingScreen??!1,C=be(ee,"rooms",t,"participants",r.uid);if(f){w.current?.getTracks().forEach(g=>g.stop()),w.current=null;const l=n.getVideoTracks()[0];l&&(l.enabled=!0);for(const g of N.current.values()){const m=g.getSenders().find(i=>i.track?.kind==="video");m&&l&&await m.replaceTrack(l)}c(g=>g.map(m=>m.uid===r.uid?{...m,isSharingScreen:!1,isCameraOn:!0,stream:n}:m)),await je(C,{isSharingScreen:!1,isCameraOn:!0})}else try{const l=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});w.current=l;const g=l.getVideoTracks()[0];n.getVideoTracks()[0].enabled=!1,g.onended=()=>{E?.isSharingScreen&&X()};for(const m of N.current.values()){const i=m.getSenders().find(b=>b.track?.kind==="video");i&&await i.replaceTrack(g)}c(m=>m.map(i=>i.uid===r.uid?{...i,isSharingScreen:!0,isCameraOn:!1,stream:l}:i)),await je(C,{isSharingScreen:!0,isCameraOn:!1})}catch{n.getVideoTracks()[0].enabled=!0,o({variant:"destructive",title:"Error",description:"Could not start screen sharing."})}};return{participants:d,localParticipant:E,isJoining:h,toggleMute:q,toggleCamera:Z,toggleScreenShare:X,leaveRoom:W}}function Be({participant:t,room:n,isLocal:s=!1,localVideoRef:r,isMainView:o=!1}){const u=a.useRef(null);return a.useEffect(()=>{!s&&u.current&&t.stream?(u.current.srcObject=t.stream,u.current.play().catch(d=>{})):s&&r?.current&&t.stream&&(r.current.srcObject=t.stream,r.current.play().catch(d=>{}))},[t.stream,s,r]),e.jsxs("div",{className:`relative bg-gray-900 rounded-xl overflow-hidden group transition-all duration-200 shadow-lg border border-gray-700/50 aspect-video ${t.isSpeaking?"ring-2 ring-green-400 ring-opacity-75 border-green-400/50":"hover:ring-1 hover:ring-blue-400 hover:ring-opacity-50 hover:border-blue-400/50"}`,children:[e.jsx("video",{ref:s?r:u,autoPlay:!0,playsInline:!0,muted:s,className:"w-full h-full object-cover"}),!t.isCameraOn&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-gray-800 to-gray-900",children:[e.jsx("div",{className:`${o?"w-24 h-24":"w-14 h-14"} bg-gradient-to-br from-gray-600 to-gray-700 rounded-full flex items-center justify-center mb-3 shadow-lg border border-gray-500/30`,children:e.jsx("span",{className:`${o?"text-3xl":"text-xl"} font-bold text-white`,children:(s?"You":t.name||"User").charAt(0).toUpperCase()})}),o&&e.jsx("span",{className:"text-gray-300 text-base font-medium",children:s?"You":t.name})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"bg-black/60 backdrop-blur-sm px-3 py-1.5 rounded-lg border border-white/10",children:e.jsxs("span",{className:`text-white font-medium truncate ${o?"text-base":"text-sm"}`,children:[s?"You":t.name,s&&e.jsx("span",{className:"ml-1 text-blue-400",children:"•"})]})}),t.uid===n?.hostId&&e.jsx("div",{className:"bg-yellow-500/20 backdrop-blur-sm p-1.5 rounded-lg border border-yellow-400/30",children:e.jsx(dt,{className:`${o?"h-4 w-4":"h-3 w-3"} text-yellow-400`})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.isMuted?e.jsx("div",{className:"bg-red-500/90 backdrop-blur-sm p-1.5 rounded-lg border border-red-400/30",children:e.jsx(Pe,{className:`${o?"h-3.5 w-3.5":"h-3 w-3"} text-white`})}):t.isSpeaking&&e.jsx("div",{className:"bg-green-500/90 backdrop-blur-sm p-1.5 rounded-lg border border-green-400/30 animate-pulse",children:e.jsx(ke,{className:`${o?"h-3.5 w-3.5":"h-3 w-3"} text-white`})}),!t.isCameraOn&&e.jsx("div",{className:"bg-red-500/90 backdrop-blur-sm p-1.5 rounded-lg border border-red-400/30",children:e.jsx(Te,{className:`${o?"h-3.5 w-3.5":"h-3 w-3"} text-white`})})]})]})}),t.isSpeaking&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsxs("div",{className:"flex items-center gap-1.5 bg-green-500/90 backdrop-blur-sm text-white px-3 py-1.5 rounded-lg text-xs font-medium border border-green-400/30",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"Speaking"]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("div",{className:"flex gap-0.5 bg-black/50 backdrop-blur-sm px-2 py-1 rounded-lg",children:[e.jsx("div",{className:"w-1 h-2.5 bg-green-400 rounded-full"}),e.jsx("div",{className:"w-1 h-2.5 bg-green-400 rounded-full"}),e.jsx("div",{className:"w-1 h-2.5 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-1 h-2.5 bg-gray-500 rounded-full"})]})}),!o&&e.jsx("div",{className:"absolute inset-0 bg-blue-500/0 group-hover:bg-blue-500/5 transition-all duration-200 rounded-xl"})]})}function Js({participants:t,localVideoRef:n,firebaseUser:s,room:r,sidebarOpen:o}){const[u,d]=a.useState(null),c=t.filter(y=>y.uid||y.userId),h=c.length;a.useEffect(()=>{const y=c.find(P=>P.isSpeaking);y&&y.uid!==u?.uid?d(y):!u&&c.length>0&&d(c[0])},[c,u]);const x=y=>y===1?{container:"flex items-center justify-center",grid:"w-full max-w-2xl",cols:"grid-cols-1"}:y===2?{container:"flex items-center justify-center",grid:"w-full max-w-6xl",cols:"grid-cols-1 lg:grid-cols-2"}:y===3?{container:"flex items-center justify-center",grid:"w-full max-w-5xl",cols:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}:y===4?{container:"flex items-center justify-center",grid:"w-full max-w-6xl",cols:"grid-cols-2 lg:grid-cols-2"}:y<=6?{container:"flex items-center justify-center",grid:"w-full max-w-7xl",cols:"grid-cols-2 md:grid-cols-3"}:y<=9?{container:"flex items-center justify-center",grid:"w-full max-w-7xl",cols:"grid-cols-2 md:grid-cols-3 lg:grid-cols-3"}:{container:"flex items-center justify-center",grid:"w-full max-w-7xl",cols:"grid-cols-2 md:grid-cols-3 lg:grid-cols-4"};if(h<=6){const y=x(h);return e.jsx("div",{className:`h-[calc(100vh-140px)] ${y.container} p-2 sm:p-4 lg:p-6 transition-all duration-300 ${o?"lg:mr-80":""}`,children:e.jsx("div",{className:`grid gap-4 ${y.grid} ${y.cols} ${h===1?"max-h-96":""}`,children:c.map(P=>{const _=P.uid===s?.uid;return e.jsx(Be,{participant:P,room:r,isLocal:_,localVideoRef:_?n:void 0,isMainView:!0},P.uid||P.userId||"local")})})})}const R=c.filter(y=>y.uid!==u?.uid);return e.jsxs("div",{className:`h-[calc(100vh-140px)] flex flex-col transition-all duration-300 ${o?"lg:mr-80":""}`,children:[e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 pb-2",children:e.jsx("div",{className:"w-full max-w-5xl",children:u&&e.jsx(Be,{participant:u,room:r,isLocal:u.uid===s?.uid,localVideoRef:u.uid===s?.uid?n:void 0,isMainView:!0},u.uid||u.userId||"main")})}),R.length>0&&e.jsx("div",{className:"flex-shrink-0 px-6 pb-6",children:e.jsx("div",{className:"flex gap-3 justify-center overflow-x-auto pb-2",children:R.map(y=>{const P=y.uid===s?.uid;return e.jsx("div",{className:"flex-shrink-0 w-36 cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg",onClick:()=>d(y),children:e.jsx(Be,{participant:y,room:r,isLocal:P,localVideoRef:P?n:void 0,isMainView:!1})},y.uid||y.userId||"thumb")})})})]})}function Gs(){const{roomId:t}=ns(),n=ye(),{user:s,firebaseUser:r}=ve(),{toast:o}=Ye(),[u,d]=a.useState(!1),[c,h]=a.useState(!1),[x,R]=a.useState(""),[y,P]=a.useState([]),[_,N]=a.useState(0),[v,w]=a.useState(null),[S,j]=a.useState(null),[E,W]=a.useState(!0),[L,J]=a.useState(!1),V=a.useRef(null),{participants:F,localParticipant:G,isJoining:q,toggleMute:Z,toggleCamera:X,leaveRoom:f}=qs(t||"",v);a.useEffect(()=>{},[F]),a.useEffect(()=>{if(!t||!r)return;const i=setTimeout(()=>{J(!0)},1e4);return(async()=>{try{const k=await Q.getRoom(t);if(!k)throw new Error("Room not found");j(k);const U=(()=>{const H=S?.participants?.length||1;return H<=2?{width:1280,height:720,frameRate:30}:H<=4?{width:960,height:540,frameRate:24}:H<=8?{width:640,height:360,frameRate:20}:{width:480,height:270,frameRate:15}})(),B=await navigator.mediaDevices.getUserMedia({video:{...U,facingMode:"user"},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3}});if(w(B),V.current&&(V.current.srcObject=B,V.current.play().catch(H=>{})),W(!1),typeof q<"u")try{typeof setIsJoining=="function"&&setIsJoining(!1)}catch{}clearTimeout(i)}catch{o({variant:"destructive",title:"Error",description:"Failed to initialize room. Please check your camera and microphone permissions."}),W(!1),clearTimeout(i)}})(),()=>{clearTimeout(i),v&&v.getTracks().forEach(k=>k.stop())}},[t,r,s.name,n,o]),a.useEffect(()=>{if(!t)return;let i=0,b=!0;const k=Q.subscribeToRoomMessages(t,M=>{P(M),!b&&M.length>i&&N(U=>{if(!u){const B=M.length-i;return U+B}return U}),i=M.length,b=!1});return()=>k()},[t,u]),a.useEffect(()=>{u&&N(0)},[u]);const C=async()=>{if(!(!x.trim()||!t||!r))try{await Q.sendMessage(t,r.uid,s.name||"Anonymous",x),R("")}catch{o({variant:"destructive",title:"Error",description:"Failed to send message"})}},l=()=>{S?.roomKey&&(navigator.clipboard.writeText(S.roomKey),o({title:"Copied!",description:"Room key copied to clipboard"}))},g=async()=>{if(t&&r)try{await Q.clearRoomMessages(t),o({title:"Chat cleared!",description:"All chat messages have been cleared"})}catch{o({title:"Error",description:"Failed to clear chat messages",variant:"destructive"})}},m=async()=>{if(r&&t)try{await Q.leaveRoom(t,r.uid)}catch{}f(),n("/rooms")};return a.useEffect(()=>{const i=async()=>{if(r&&t)try{await Q.leaveRoom(t,r.uid)}catch{}},b=async()=>{if(document.visibilityState==="hidden"&&r&&t)try{await Q.leaveRoom(t,r.uid)}catch{}};return window.addEventListener("beforeunload",i),document.addEventListener("visibilitychange",b),()=>{window.removeEventListener("beforeunload",i),document.removeEventListener("visibilitychange",b),r&&t&&Q.leaveRoom(t,r.uid).catch(k=>{})}},[r,t]),L?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"rounded-full h-8 w-8 border-b-2 border-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 font-semibold",children:"Unable to connect to room. Please check your network, Firestore index, or permissions."}),e.jsx($,{onClick:()=>n("/rooms"),className:"mt-4",children:"Back to Rooms"})]})}):E||q?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Connecting to room..."})]})}):S?e.jsxs("div",{className:"min-h-screen bg-gray-900 flex flex-col",children:[e.jsx("div",{className:"flex-shrink-0 bg-gray-900 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 lg:px-6 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0 flex-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>n("/rooms"),className:"text-gray-300 hover:text-white hover:bg-gray-800 p-2 flex-shrink-0",children:e.jsx(Cs,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("h1",{className:"text-sm sm:text-lg font-medium text-white truncate",children:S?.name||"Loading..."}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsx(ct,{variant:S?.type==="public"?"default":"secondary",className:"bg-gray-700 text-gray-200 text-xs hidden sm:inline-flex",children:S?.type==="public"?"Public":"Private"}),S?.roomKey&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-mono bg-gray-800 text-gray-300 px-1 sm:px-2 py-1 rounded",children:S.roomKey}),e.jsx($,{size:"sm",variant:"ghost",onClick:l,className:"text-gray-400 hover:text-white p-1",children:e.jsx(As,{className:"h-3 w-3"})})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-shrink-0",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-400 hidden sm:block",children:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:[F.length," participant",F.length!==1?"s":""]}),F.length>8&&e.jsx("div",{className:"px-1 sm:px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded-full border border-yellow-500/30 hidden lg:block",children:"Large Room"}),F.length>15&&e.jsx("div",{className:"px-1 sm:px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded-full border border-red-500/30 hidden lg:block",children:"Performance Mode"})]})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(Js,{participants:F,localVideoRef:V,firebaseUser:r,room:S,sidebarOpen:c||u}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-700",children:e.jsx("div",{className:"flex items-center justify-center py-3 sm:py-4 px-3 sm:px-6",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx($,{variant:"ghost",size:"lg",onClick:Z,className:`rounded-full w-10 h-10 sm:w-12 sm:h-12 transition-all duration-200 ${G?.isMuted?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:G?.isMuted?e.jsx(Pe,{className:"h-4 w-4 sm:h-5 sm:w-5"}):e.jsx(ke,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx($,{variant:"ghost",size:"lg",onClick:X,className:`rounded-full w-10 h-10 sm:w-12 sm:h-12 transition-all duration-200 ${G?.isCameraOn?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:G?.isCameraOn?e.jsx(Ce,{className:"h-4 w-4 sm:h-5 sm:w-5"}):e.jsx(Te,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx($,{variant:"ghost",size:"lg",onClick:m,className:"rounded-full w-10 h-10 sm:w-12 sm:h-12 bg-red-600 hover:bg-red-700 text-white transition-all duration-200",children:e.jsx(Rs,{className:"h-4 w-4 sm:h-5 sm:w-5 rotate-[135deg]"})}),e.jsx($,{variant:"ghost",size:"lg",onClick:()=>h(!c),className:`rounded-full w-10 h-10 sm:w-12 sm:h-12 transition-all duration-200 ${c?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:e.jsx(Re,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsxs($,{variant:"ghost",size:"lg",onClick:()=>d(!u),className:`rounded-full w-10 h-10 sm:w-12 sm:h-12 relative transition-all duration-200 ${u?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:[e.jsx(Ve,{className:"h-4 w-4 sm:h-5 sm:w-5"}),_>0&&e.jsx("div",{className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 bg-red-500 text-white rounded-full min-w-[16px] h-4 sm:min-w-[20px] sm:h-5 flex items-center justify-center text-xs font-bold animate-pulse border-2 border-gray-900",children:_>99?"99+":_})]})]})})}),c&&e.jsxs("div",{className:"fixed top-0 right-0 h-full w-80 bg-white border-l border-gray-200 shadow-xl z-50 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-gray-600"}),e.jsxs("h3",{className:"font-medium text-gray-900",children:["People (",F.length,")"]})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full w-8 h-8 p-0",children:"✕"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-2",children:F.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-white",children:(i.name||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[i.name,i.uid===r?.uid&&" (You)"]}),i.uid===S?.hostId&&e.jsx(dt,{className:"h-3 w-3 text-yellow-500"})]}),i.uid===S?.hostId&&e.jsx("span",{className:"text-xs text-gray-500",children:"Host"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.isMuted?e.jsx("div",{className:"p-1 rounded-full bg-red-100",children:e.jsx(Pe,{className:"h-3 w-3 text-red-600"})}):e.jsx("div",{className:"p-1 rounded-full bg-green-100",children:e.jsx(ke,{className:"h-3 w-3 text-green-600"})}),i.isCameraOn?e.jsx("div",{className:"p-1 rounded-full bg-green-100",children:e.jsx(Ce,{className:"h-3 w-3 text-green-600"})}):e.jsx("div",{className:"p-1 rounded-full bg-red-100",children:e.jsx(Te,{className:"h-3 w-3 text-red-600"})})]})]},i.uid||i.userId||Math.random()))})})]}),u&&e.jsxs("div",{className:"fixed top-0 right-0 h-full w-80 bg-white/95 backdrop-blur-sm border-l border-gray-200/50 shadow-2xl z-50 flex flex-col","data-chat-open":"true",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200/50 flex items-center justify-between bg-white/80 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(Ve,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Chat"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:g,className:"text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full w-8 h-8 p-0 transition-colors",title:"Clear all messages",children:"🗑️"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full w-8 h-8 p-0 transition-colors",children:"✕"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:y.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm mt-12",children:e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl mb-4",children:[e.jsx(Ve,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"font-medium text-gray-600 mb-1",children:"No messages yet"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Start the conversation!"})]})}):y.map(i=>e.jsx("div",{className:"group",children:e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50/50 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-900 truncate",children:[i.userName,i.userId===r?.uid&&e.jsx("span",{className:"ml-1 text-blue-600 font-normal",children:"(You)"})]}),e.jsx("span",{className:"text-xs text-gray-500 flex-shrink-0",children:i.timestamp?.toDate?.()?.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})||"now"})]}),e.jsx("div",{className:"text-sm text-gray-700 break-words leading-relaxed",children:i.message})]})]})},i.id))}),e.jsx("div",{className:"p-4 border-t border-gray-200/50 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ge,{value:x,onChange:i=>R(i.target.value),placeholder:"Send a message to everyone",onKeyDown:i=>i.key==="Enter"&&!i.shiftKey&&C(),className:"flex-1 border-gray-300 focus:border-blue-500 focus:ring-blue-500 bg-white/90 backdrop-blur-sm"}),e.jsx($,{size:"sm",onClick:C,disabled:!x.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 transition-colors",children:e.jsx(Us,{className:"h-4 w-4"})})]})})]})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Room not found"}),e.jsx($,{onClick:()=>n("/rooms"),className:"mt-4",children:"Back to Rooms"})]})})}function rt(t,[n,s]){return Math.min(s,Math.max(n,t))}var ut=a.forwardRef((t,n)=>{const{children:s,...r}=t,o=a.Children.toArray(s),u=o.find(Zs);if(u){const d=u.props.children,c=o.map(h=>h===u?a.Children.count(d)>1?a.Children.only(null):a.isValidElement(d)?d.props.children:null:h);return e.jsx($e,{...r,ref:n,children:a.isValidElement(d)?a.cloneElement(d,void 0,c):null})}return e.jsx($e,{...r,ref:n,children:s})});ut.displayName="Slot";var $e=a.forwardRef((t,n)=>{const{children:s,...r}=t;if(a.isValidElement(s)){const o=Qs(s),u=Xs(r,s.props);return s.type!==a.Fragment&&(u.ref=n?as(n,o):o),a.cloneElement(s,u)}return a.Children.count(s)>1?a.Children.only(null):null});$e.displayName="SlotClone";var Ys=({children:t})=>e.jsx(e.Fragment,{children:t});function Zs(t){return a.isValidElement(t)&&t.type===Ys}function Xs(t,n){const s={...n};for(const r in n){const o=t[r],u=n[r];/^on[A-Z]/.test(r)?o&&u?s[r]=(...c)=>{u(...c),o(...c)}:o&&(s[r]=o):r==="style"?s[r]={...o,...u}:r==="className"&&(s[r]=[o,u].filter(Boolean).join(" "))}return{...t,...s}}function Qs(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}function er(t){const n=a.useRef({value:t,previous:t});return a.useMemo(()=>(n.current.value!==t&&(n.current.previous=n.current.value,n.current.value=t),n.current.previous),[t])}var tr=[" ","Enter","ArrowUp","ArrowDown"],sr=[" ","Enter"],we="Select",[Ie,Me,rr]=is(we),[he,Jr]=os(we,[rr,it]),_e=it(),[nr,ie]=he(we),[ar,or]=he(we),mt=t=>{const{__scopeSelect:n,children:s,open:r,defaultOpen:o,onOpenChange:u,value:d,defaultValue:c,onValueChange:h,dir:x,name:R,autoComplete:y,disabled:P,required:_,form:N}=t,v=_e(n),[w,S]=a.useState(null),[j,E]=a.useState(null),[W,L]=a.useState(!1),J=ks(x),[V=!1,F]=et({prop:r,defaultProp:o,onChange:u}),[G,q]=et({prop:d,defaultProp:c,onChange:h}),Z=a.useRef(null),X=w?N||!!w.closest("form"):!0,[f,C]=a.useState(new Set),l=Array.from(f).map(g=>g.props.value).join(";");return e.jsx(ps,{...v,children:e.jsxs(nr,{required:_,scope:n,trigger:w,onTriggerChange:S,valueNode:j,onValueNodeChange:E,valueNodeHasChildren:W,onValueNodeHasChildrenChange:L,contentId:Ze(),value:G,onValueChange:q,open:V,onOpenChange:F,dir:J,triggerPointerDownPosRef:Z,disabled:P,children:[e.jsx(Ie.Provider,{scope:n,children:e.jsx(ar,{scope:t.__scopeSelect,onNativeOptionAdd:a.useCallback(g=>{C(m=>new Set(m).add(g))},[]),onNativeOptionRemove:a.useCallback(g=>{C(m=>{const i=new Set(m);return i.delete(g),i})},[]),children:s})}),X?e.jsxs(Lt,{"aria-hidden":!0,required:_,tabIndex:-1,name:R,autoComplete:y,value:G,onChange:g=>q(g.target.value),disabled:P,form:N,children:[G===void 0?e.jsx("option",{value:""}):null,Array.from(f)]},l):null]})})};mt.displayName=we;var ft="SelectTrigger",ht=a.forwardRef((t,n)=>{const{__scopeSelect:s,disabled:r=!1,...o}=t,u=_e(s),d=ie(ft,s),c=d.disabled||r,h=ne(n,d.onTriggerChange),x=Me(s),R=a.useRef("touch"),[y,P,_]=Vt(v=>{const w=x().filter(E=>!E.disabled),S=w.find(E=>E.value===d.value),j=Bt(w,v,S);j!==void 0&&d.onValueChange(j.value)}),N=v=>{c||(d.onOpenChange(!0),_()),v&&(d.triggerPointerDownPosRef.current={x:Math.round(v.pageX),y:Math.round(v.pageY)})};return e.jsx(gs,{asChild:!0,...u,children:e.jsx(te.button,{type:"button",role:"combobox","aria-controls":d.contentId,"aria-expanded":d.open,"aria-required":d.required,"aria-autocomplete":"none",dir:d.dir,"data-state":d.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":Dt(d.value)?"":void 0,...o,ref:h,onClick:Y(o.onClick,v=>{v.currentTarget.focus(),R.current!=="mouse"&&N(v)}),onPointerDown:Y(o.onPointerDown,v=>{R.current=v.pointerType;const w=v.target;w.hasPointerCapture(v.pointerId)&&w.releasePointerCapture(v.pointerId),v.button===0&&v.ctrlKey===!1&&v.pointerType==="mouse"&&(N(v),v.preventDefault())}),onKeyDown:Y(o.onKeyDown,v=>{const w=y.current!=="";!(v.ctrlKey||v.altKey||v.metaKey)&&v.key.length===1&&P(v.key),!(w&&v.key===" ")&&tr.includes(v.key)&&(N(),v.preventDefault())})})})});ht.displayName=ft;var pt="SelectValue",gt=a.forwardRef((t,n)=>{const{__scopeSelect:s,className:r,style:o,children:u,placeholder:d="",...c}=t,h=ie(pt,s),{onValueNodeHasChildrenChange:x}=h,R=u!==void 0,y=ne(n,h.onValueNodeChange);return ae(()=>{x(R)},[x,R]),e.jsx(te.span,{...c,ref:y,style:{pointerEvents:"none"},children:Dt(h.value)?e.jsx(e.Fragment,{children:d}):u})});gt.displayName=pt;var ir="SelectIcon",xt=a.forwardRef((t,n)=>{const{__scopeSelect:s,children:r,...o}=t;return e.jsx(te.span,{"aria-hidden":!0,...o,ref:n,children:r||"▼"})});xt.displayName=ir;var cr="SelectPortal",vt=t=>e.jsx(ls,{asChild:!0,...t});vt.displayName=cr;var me="SelectContent",yt=a.forwardRef((t,n)=>{const s=ie(me,t.__scopeSelect),[r,o]=a.useState();if(ae(()=>{o(new DocumentFragment)},[]),!s.open){const u=r;return u?ot.createPortal(e.jsx(wt,{scope:t.__scopeSelect,children:e.jsx(Ie.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),u):null}return e.jsx(bt,{...t,ref:n})});yt.displayName=me;var se=10,[wt,ce]=he(me),lr="SelectContentImpl",bt=a.forwardRef((t,n)=>{const{__scopeSelect:s,position:r="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:u,onPointerDownOutside:d,side:c,sideOffset:h,align:x,alignOffset:R,arrowPadding:y,collisionBoundary:P,collisionPadding:_,sticky:N,hideWhenDetached:v,avoidCollisions:w,...S}=t,j=ie(me,s),[E,W]=a.useState(null),[L,J]=a.useState(null),V=ne(n,p=>W(p)),[F,G]=a.useState(null),[q,Z]=a.useState(null),X=Me(s),[f,C]=a.useState(!1),l=a.useRef(!1);a.useEffect(()=>{if(E)return xs(E)},[E]),vs();const g=a.useCallback(p=>{const[I,...D]=X().map(K=>K.ref.current),[O]=D.slice(-1),z=document.activeElement;for(const K of p)if(K===z||(K?.scrollIntoView({block:"nearest"}),K===I&&L&&(L.scrollTop=0),K===O&&L&&(L.scrollTop=L.scrollHeight),K?.focus(),document.activeElement!==z))return},[X,L]),m=a.useCallback(()=>g([F,E]),[g,F,E]);a.useEffect(()=>{f&&m()},[f,m]);const{onOpenChange:i,triggerPointerDownPosRef:b}=j;a.useEffect(()=>{if(E){let p={x:0,y:0};const I=O=>{p={x:Math.abs(Math.round(O.pageX)-(b.current?.x??0)),y:Math.abs(Math.round(O.pageY)-(b.current?.y??0))}},D=O=>{p.x<=10&&p.y<=10?O.preventDefault():E.contains(O.target)||i(!1),document.removeEventListener("pointermove",I),b.current=null};return b.current!==null&&(document.addEventListener("pointermove",I),document.addEventListener("pointerup",D,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",I),document.removeEventListener("pointerup",D,{capture:!0})}}},[E,i,b]),a.useEffect(()=>{const p=()=>i(!1);return window.addEventListener("blur",p),window.addEventListener("resize",p),()=>{window.removeEventListener("blur",p),window.removeEventListener("resize",p)}},[i]);const[k,M]=Vt(p=>{const I=X().filter(z=>!z.disabled),D=I.find(z=>z.ref.current===document.activeElement),O=Bt(I,p,D);O&&setTimeout(()=>O.ref.current.focus())}),U=a.useCallback((p,I,D)=>{const O=!l.current&&!D;(j.value!==void 0&&j.value===I||O)&&(G(p),O&&(l.current=!0))},[j.value]),B=a.useCallback(()=>E?.focus(),[E]),H=a.useCallback((p,I,D)=>{const O=!l.current&&!D;(j.value!==void 0&&j.value===I||O)&&Z(p)},[j.value]),A=r==="popper"?ze:jt,T=A===ze?{side:c,sideOffset:h,align:x,alignOffset:R,arrowPadding:y,collisionBoundary:P,collisionPadding:_,sticky:N,hideWhenDetached:v,avoidCollisions:w}:{};return e.jsx(wt,{scope:s,content:E,viewport:L,onViewportChange:J,itemRefCallback:U,selectedItem:F,onItemLeave:B,itemTextRefCallback:H,focusSelectedItem:m,selectedItemText:q,position:r,isPositioned:f,searchRef:k,children:e.jsx(ys,{as:ut,allowPinchZoom:!0,children:e.jsx(ws,{asChild:!0,trapped:j.open,onMountAutoFocus:p=>{p.preventDefault()},onUnmountAutoFocus:Y(o,p=>{j.trigger?.focus({preventScroll:!0}),p.preventDefault()}),children:e.jsx(us,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:p=>p.preventDefault(),onDismiss:()=>j.onOpenChange(!1),children:e.jsx(A,{role:"listbox",id:j.contentId,"data-state":j.open?"open":"closed",dir:j.dir,onContextMenu:p=>p.preventDefault(),...S,...T,onPlaced:()=>C(!0),ref:V,style:{display:"flex",flexDirection:"column",outline:"none",...S.style},onKeyDown:Y(S.onKeyDown,p=>{const I=p.ctrlKey||p.altKey||p.metaKey;if(p.key==="Tab"&&p.preventDefault(),!I&&p.key.length===1&&M(p.key),["ArrowUp","ArrowDown","Home","End"].includes(p.key)){let O=X().filter(z=>!z.disabled).map(z=>z.ref.current);if(["ArrowUp","End"].includes(p.key)&&(O=O.slice().reverse()),["ArrowUp","ArrowDown"].includes(p.key)){const z=p.target,K=O.indexOf(z);O=O.slice(K+1)}setTimeout(()=>g(O)),p.preventDefault()}})})})})})})});bt.displayName=lr;var dr="SelectItemAlignedPosition",jt=a.forwardRef((t,n)=>{const{__scopeSelect:s,onPlaced:r,...o}=t,u=ie(me,s),d=ce(me,s),[c,h]=a.useState(null),[x,R]=a.useState(null),y=ne(n,V=>R(V)),P=Me(s),_=a.useRef(!1),N=a.useRef(!0),{viewport:v,selectedItem:w,selectedItemText:S,focusSelectedItem:j}=d,E=a.useCallback(()=>{if(u.trigger&&u.valueNode&&c&&x&&v&&w&&S){const V=u.trigger.getBoundingClientRect(),F=x.getBoundingClientRect(),G=u.valueNode.getBoundingClientRect(),q=S.getBoundingClientRect();if(u.dir!=="rtl"){const z=q.left-F.left,K=G.left-z,le=V.left-K,de=V.width+le,Ae=Math.max(de,F.width),Oe=window.innerWidth-se,De=rt(K,[se,Math.max(se,Oe-Ae)]);c.style.minWidth=de+"px",c.style.left=De+"px"}else{const z=F.right-q.right,K=window.innerWidth-G.right-z,le=window.innerWidth-V.right-K,de=V.width+le,Ae=Math.max(de,F.width),Oe=window.innerWidth-se,De=rt(K,[se,Math.max(se,Oe-Ae)]);c.style.minWidth=de+"px",c.style.right=De+"px"}const Z=P(),X=window.innerHeight-se*2,f=v.scrollHeight,C=window.getComputedStyle(x),l=parseInt(C.borderTopWidth,10),g=parseInt(C.paddingTop,10),m=parseInt(C.borderBottomWidth,10),i=parseInt(C.paddingBottom,10),b=l+g+f+i+m,k=Math.min(w.offsetHeight*5,b),M=window.getComputedStyle(v),U=parseInt(M.paddingTop,10),B=parseInt(M.paddingBottom,10),H=V.top+V.height/2-se,A=X-H,T=w.offsetHeight/2,p=w.offsetTop+T,I=l+g+p,D=b-I;if(I<=H){const z=Z.length>0&&w===Z[Z.length-1].ref.current;c.style.bottom="0px";const K=x.clientHeight-v.offsetTop-v.offsetHeight,le=Math.max(A,T+(z?B:0)+K+m),de=I+le;c.style.height=de+"px"}else{const z=Z.length>0&&w===Z[0].ref.current;c.style.top="0px";const le=Math.max(H,l+v.offsetTop+(z?U:0)+T)+D;c.style.height=le+"px",v.scrollTop=I-H+v.offsetTop}c.style.margin=`${se}px 0`,c.style.minHeight=k+"px",c.style.maxHeight=X+"px",r?.(),requestAnimationFrame(()=>_.current=!0)}},[P,u.trigger,u.valueNode,c,x,v,w,S,u.dir,r]);ae(()=>E(),[E]);const[W,L]=a.useState();ae(()=>{x&&L(window.getComputedStyle(x).zIndex)},[x]);const J=a.useCallback(V=>{V&&N.current===!0&&(E(),j?.(),N.current=!1)},[E,j]);return e.jsx(mr,{scope:s,contentWrapper:c,shouldExpandOnScrollRef:_,onScrollButtonChange:J,children:e.jsx("div",{ref:h,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:W},children:e.jsx(te.div,{...o,ref:y,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});jt.displayName=dr;var ur="SelectPopperPosition",ze=a.forwardRef((t,n)=>{const{__scopeSelect:s,align:r="start",collisionPadding:o=se,...u}=t,d=_e(s);return e.jsx(bs,{...d,...u,ref:n,align:r,collisionPadding:o,style:{boxSizing:"border-box",...u.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});ze.displayName=ur;var[mr,Xe]=he(me,{}),Fe="SelectViewport",Nt=a.forwardRef((t,n)=>{const{__scopeSelect:s,nonce:r,...o}=t,u=ce(Fe,s),d=Xe(Fe,s),c=ne(n,u.onViewportChange),h=a.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),e.jsx(Ie.Slot,{scope:s,children:e.jsx(te.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:Y(o.onScroll,x=>{const R=x.currentTarget,{contentWrapper:y,shouldExpandOnScrollRef:P}=d;if(P?.current&&y){const _=Math.abs(h.current-R.scrollTop);if(_>0){const N=window.innerHeight-se*2,v=parseFloat(y.style.minHeight),w=parseFloat(y.style.height),S=Math.max(v,w);if(S<N){const j=S+_,E=Math.min(N,j),W=j-E;y.style.height=E+"px",y.style.bottom==="0px"&&(R.scrollTop=W>0?W:0,y.style.justifyContent="flex-end")}}}h.current=R.scrollTop})})})]})});Nt.displayName=Fe;var St="SelectGroup",[fr,hr]=he(St),pr=a.forwardRef((t,n)=>{const{__scopeSelect:s,...r}=t,o=Ze();return e.jsx(fr,{scope:s,id:o,children:e.jsx(te.div,{role:"group","aria-labelledby":o,...r,ref:n})})});pr.displayName=St;var Ct="SelectLabel",Rt=a.forwardRef((t,n)=>{const{__scopeSelect:s,...r}=t,o=hr(Ct,s);return e.jsx(te.div,{id:o.id,...r,ref:n})});Rt.displayName=Ct;var Ee="SelectItem",[gr,Pt]=he(Ee),kt=a.forwardRef((t,n)=>{const{__scopeSelect:s,value:r,disabled:o=!1,textValue:u,...d}=t,c=ie(Ee,s),h=ce(Ee,s),x=c.value===r,[R,y]=a.useState(u??""),[P,_]=a.useState(!1),N=ne(n,j=>h.itemRefCallback?.(j,r,o)),v=Ze(),w=a.useRef("touch"),S=()=>{o||(c.onValueChange(r),c.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(gr,{scope:s,value:r,disabled:o,textId:v,isSelected:x,onItemTextChange:a.useCallback(j=>{y(E=>E||(j?.textContent??"").trim())},[]),children:e.jsx(Ie.ItemSlot,{scope:s,value:r,disabled:o,textValue:R,children:e.jsx(te.div,{role:"option","aria-labelledby":v,"data-highlighted":P?"":void 0,"aria-selected":x&&P,"data-state":x?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...d,ref:N,onFocus:Y(d.onFocus,()=>_(!0)),onBlur:Y(d.onBlur,()=>_(!1)),onClick:Y(d.onClick,()=>{w.current!=="mouse"&&S()}),onPointerUp:Y(d.onPointerUp,()=>{w.current==="mouse"&&S()}),onPointerDown:Y(d.onPointerDown,j=>{w.current=j.pointerType}),onPointerMove:Y(d.onPointerMove,j=>{w.current=j.pointerType,o?h.onItemLeave?.():w.current==="mouse"&&j.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Y(d.onPointerLeave,j=>{j.currentTarget===document.activeElement&&h.onItemLeave?.()}),onKeyDown:Y(d.onKeyDown,j=>{h.searchRef?.current!==""&&j.key===" "||(sr.includes(j.key)&&S(),j.key===" "&&j.preventDefault())})})})})});kt.displayName=Ee;var xe="SelectItemText",Tt=a.forwardRef((t,n)=>{const{__scopeSelect:s,className:r,style:o,...u}=t,d=ie(xe,s),c=ce(xe,s),h=Pt(xe,s),x=or(xe,s),[R,y]=a.useState(null),P=ne(n,S=>y(S),h.onItemTextChange,S=>c.itemTextRefCallback?.(S,h.value,h.disabled)),_=R?.textContent,N=a.useMemo(()=>e.jsx("option",{value:h.value,disabled:h.disabled,children:_},h.value),[h.disabled,h.value,_]),{onNativeOptionAdd:v,onNativeOptionRemove:w}=x;return ae(()=>(v(N),()=>w(N)),[v,w,N]),e.jsxs(e.Fragment,{children:[e.jsx(te.span,{id:h.textId,...u,ref:P}),h.isSelected&&d.valueNode&&!d.valueNodeHasChildren?ot.createPortal(u.children,d.valueNode):null]})});Tt.displayName=xe;var Et="SelectItemIndicator",It=a.forwardRef((t,n)=>{const{__scopeSelect:s,...r}=t;return Pt(Et,s).isSelected?e.jsx(te.span,{"aria-hidden":!0,...r,ref:n}):null});It.displayName=Et;var Ue="SelectScrollUpButton",Mt=a.forwardRef((t,n)=>{const s=ce(Ue,t.__scopeSelect),r=Xe(Ue,t.__scopeSelect),[o,u]=a.useState(!1),d=ne(n,r.onScrollButtonChange);return ae(()=>{if(s.viewport&&s.isPositioned){let c=function(){const x=h.scrollTop>0;u(x)};const h=s.viewport;return c(),h.addEventListener("scroll",c),()=>h.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),o?e.jsx(At,{...t,ref:d,onAutoScroll:()=>{const{viewport:c,selectedItem:h}=s;c&&h&&(c.scrollTop=c.scrollTop-h.offsetHeight)}}):null});Mt.displayName=Ue;var Ke="SelectScrollDownButton",_t=a.forwardRef((t,n)=>{const s=ce(Ke,t.__scopeSelect),r=Xe(Ke,t.__scopeSelect),[o,u]=a.useState(!1),d=ne(n,r.onScrollButtonChange);return ae(()=>{if(s.viewport&&s.isPositioned){let c=function(){const x=h.scrollHeight-h.clientHeight,R=Math.ceil(h.scrollTop)<x;u(R)};const h=s.viewport;return c(),h.addEventListener("scroll",c),()=>h.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),o?e.jsx(At,{...t,ref:d,onAutoScroll:()=>{const{viewport:c,selectedItem:h}=s;c&&h&&(c.scrollTop=c.scrollTop+h.offsetHeight)}}):null});_t.displayName=Ke;var At=a.forwardRef((t,n)=>{const{__scopeSelect:s,onAutoScroll:r,...o}=t,u=ce("SelectScrollButton",s),d=a.useRef(null),c=Me(s),h=a.useCallback(()=>{d.current!==null&&(window.clearInterval(d.current),d.current=null)},[]);return a.useEffect(()=>()=>h(),[h]),ae(()=>{c().find(R=>R.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),e.jsx(te.div,{"aria-hidden":!0,...o,ref:n,style:{flexShrink:0,...o.style},onPointerDown:Y(o.onPointerDown,()=>{d.current===null&&(d.current=window.setInterval(r,50))}),onPointerMove:Y(o.onPointerMove,()=>{u.onItemLeave?.(),d.current===null&&(d.current=window.setInterval(r,50))}),onPointerLeave:Y(o.onPointerLeave,()=>{h()})})}),xr="SelectSeparator",Ot=a.forwardRef((t,n)=>{const{__scopeSelect:s,...r}=t;return e.jsx(te.div,{"aria-hidden":!0,...r,ref:n})});Ot.displayName=xr;var We="SelectArrow",vr=a.forwardRef((t,n)=>{const{__scopeSelect:s,...r}=t,o=_e(s),u=ie(We,s),d=ce(We,s);return u.open&&d.position==="popper"?e.jsx(js,{...o,...r,ref:n}):null});vr.displayName=We;function Dt(t){return t===""||t===void 0}var Lt=a.forwardRef((t,n)=>{const{value:s,...r}=t,o=a.useRef(null),u=ne(n,o),d=er(s);return a.useEffect(()=>{const c=o.current,h=window.HTMLSelectElement.prototype,R=Object.getOwnPropertyDescriptor(h,"value").set;if(d!==s&&R){const y=new Event("change",{bubbles:!0});R.call(c,s),c.dispatchEvent(y)}},[d,s]),e.jsx(cs,{asChild:!0,children:e.jsx("select",{...r,ref:u,defaultValue:s})})});Lt.displayName="BubbleSelect";function Vt(t){const n=ds(t),s=a.useRef(""),r=a.useRef(0),o=a.useCallback(d=>{const c=s.current+d;n(c),(function h(x){s.current=x,window.clearTimeout(r.current),x!==""&&(r.current=window.setTimeout(()=>h(""),1e3))})(c)},[n]),u=a.useCallback(()=>{s.current="",window.clearTimeout(r.current)},[]);return a.useEffect(()=>()=>window.clearTimeout(r.current),[]),[s,o,u]}function Bt(t,n,s){const o=n.length>1&&Array.from(n).every(x=>x===n[0])?n[0]:n,u=s?t.indexOf(s):-1;let d=yr(t,Math.max(u,0));o.length===1&&(d=d.filter(x=>x!==s));const h=d.find(x=>x.textValue.toLowerCase().startsWith(o.toLowerCase()));return h!==s?h:void 0}function yr(t,n){return t.map((s,r)=>t[(n+r)%t.length])}var wr=mt,Ht=ht,br=gt,jr=xt,Nr=vt,$t=yt,Sr=Nt,zt=Rt,Ft=kt,Cr=Tt,Rr=It,Ut=Mt,Kt=_t,Wt=Ot;const nt=wr,at=br,qe=a.forwardRef(({className:t,children:n,...s},r)=>e.jsxs(Ht,{ref:r,className:oe("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...s,children:[n,e.jsx(jr,{asChild:!0,children:e.jsx(lt,{className:"h-4 w-4 opacity-50"})})]}));qe.displayName=Ht.displayName;const qt=a.forwardRef(({className:t,...n},s)=>e.jsx(Ut,{ref:s,className:oe("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(Ms,{className:"h-4 w-4"})}));qt.displayName=Ut.displayName;const Jt=a.forwardRef(({className:t,...n},s)=>e.jsx(Kt,{ref:s,className:oe("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(lt,{className:"h-4 w-4"})}));Jt.displayName=Kt.displayName;const Je=a.forwardRef(({className:t,children:n,position:s="popper",...r},o)=>e.jsx(Nr,{children:e.jsxs($t,{ref:o,className:oe("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...r,children:[e.jsx(qt,{}),e.jsx(Sr,{className:oe("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),e.jsx(Jt,{})]})}));Je.displayName=$t.displayName;const Pr=a.forwardRef(({className:t,...n},s)=>e.jsx(zt,{ref:s,className:oe("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...n}));Pr.displayName=zt.displayName;const Se=a.forwardRef(({className:t,children:n,...s},r)=>e.jsxs(Ft,{ref:r,className:oe("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Rr,{children:e.jsx(Ns,{className:"h-4 w-4"})})}),e.jsx(Cr,{children:n})]}));Se.displayName=Ft.displayName;const kr=a.forwardRef(({className:t,...n},s)=>e.jsx(Wt,{ref:s,className:oe("-mx-1 my-1 h-px bg-muted",t),...n}));kr.displayName=Wt.displayName;function Tr(){const[t,n]=He.useState(""),[s,r]=He.useState(!1),o=ye(),{user:u,firebaseUser:d}=ve(),{toast:c}=Ye(),h=async()=>{if(!t.trim()){c({variant:"destructive",title:"Error",description:"Please enter a room key."});return}if(!d){c({variant:"destructive",title:"Error",description:"You must be logged in to join a room."});return}r(!0);try{const x=await Q.getRoomByKey(t.toUpperCase());x?(await Q.joinRoom(x.id,d.uid,u.name||"Anonymous"),o(`/rooms/${x.id}`),n("")):c({variant:"destructive",title:"Error",description:"Room not found. Please check the room key."})}catch{c({variant:"destructive",title:"Error",description:"Failed to join room. Please try again."})}finally{r(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs(ge,{className:"p-8 w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Join Private Room"}),e.jsx(Ge,{value:t,onChange:x=>n(x.target.value),placeholder:"Enter room key"}),e.jsx($,{className:"w-full mt-4",onClick:h,disabled:!t.trim()||s,children:s?"Joining...":"Join Room"})]})})}function Er(){const[t,n]=a.useState(!1),[s,r]=a.useState(null),[o,u]=a.useState(!0),[d,c]=a.useState(!0),[h,x]=a.useState(null),[R,y]=a.useState(!1),[P,_]=a.useState(!1),[N,v]=a.useState([]),[w,S]=a.useState({name:"",type:"public",maxParticipants:10});He.useEffect(()=>{t?navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(l=>x(l)).catch(()=>x(null)):h&&(h.getTracks().forEach(l=>l.stop()),x(null))},[t]);const j=l=>{r(l),n(!0)},E=async()=>{!L||!s||(n(!1),await Q.joinRoom(s.id,L.uid,W.name||"Anonymous"),V(`/rooms/${s.id}`))},{user:W,firebaseUser:L}=ve(),{toast:J}=Ye(),V=ye(),[F,G]=a.useState(""),[q,Z]=a.useState([]),[X,f]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const g=await Ps.getSubjects();v(g)}catch{}})()},[]),a.useEffect(()=>{if(!L)return;const l=Q.subscribeToPublicRooms(m=>{Z(m)}),g=setInterval(async()=>{try{for(const m of q)await Q.cleanupStaleParticipants(m.id)}catch{}},3e4);return()=>{l(),clearInterval(g)}},[L,q]);const C=async()=>{if(!L){J({variant:"destructive",title:"Error",description:"You must be logged in to create a room."});return}if(!w.name.trim()){J({variant:"destructive",title:"Error",description:"Room name is required."});return}y(!0);try{const l=w.type==="private"?await fs():"",g={name:w.name,description:"",type:w.type,topic:"",hostId:L.uid,hostName:W.name||"Anonymous",maxParticipants:w.maxParticipants,roomKey:l,isActive:!0},m=await Q.createRoom(g);_(!1),S({name:"",type:"public",maxParticipants:10}),J({variant:"success",title:"Room Created",description:w.type==="private"?`Room key: ${l}`:"Room created successfully."}),V(`/rooms/${m}`)}catch{J({variant:"destructive",title:"Error",description:"Failed to create room. Please try again."})}finally{y(!1)}};return e.jsx(Ss,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Study Rooms"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs($,{onClick:()=>_(!0),variant:"default",children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Create Room"]}),e.jsxs($,{onClick:()=>V("/join-private-room"),variant:"outline",children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Join Private Room"]})]})]}),e.jsxs(ge,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Public Rooms"}),e.jsxs(ct,{variant:"secondary",children:[q.length," active"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:q.map(l=>e.jsx(ge,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium",children:l.name}),e.jsx(st,{className:"h-4 w-4 text-green-600"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Host: ",l.hostName]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l.participants.length,"/",l.maxParticipants]})]}),e.jsx($,{size:"sm",onClick:()=>j(l),disabled:l.participants.length>=l.maxParticipants,children:l.participants.length>=l.maxParticipants?"Full":"Join"})]})]})},l.id))}),q.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Re,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No public rooms available. Create one to get started!"})]})]}),t&&s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:e.jsx(ge,{className:"w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold",children:['Join "',s.name,'"']}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>n(!1),children:"✕"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"aspect-video bg-gray-900 rounded-lg overflow-hidden mb-4",children:h?e.jsx("video",{autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",ref:l=>{l&&h&&(l.srcObject=h)}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ce,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-400",children:"Camera not available"})]})})}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx($,{variant:d?"default":"destructive",size:"sm",onClick:()=>c(!d),children:d?e.jsx(ke,{className:"h-4 w-4"}):e.jsx(Pe,{className:"h-4 w-4"})}),e.jsx($,{variant:o?"default":"destructive",size:"sm",onClick:()=>u(!o),children:o?e.jsx(Ce,{className:"h-4 w-4"}):e.jsx(Te,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Host: ",s.hostName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Participants: ",s.participants.length,"/",s.maxParticipants]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx($,{variant:"outline",onClick:()=>n(!1),className:"flex-1",children:"Cancel"}),e.jsx($,{onClick:E,className:"flex-1",children:"Join Room"})]})]})})}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:e.jsx(ge,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Create Study Room"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>_(!1),children:"✕"})]}),e.jsxs("form",{onSubmit:l=>{l.preventDefault(),C()},children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Le,{htmlFor:"roomName",children:"Room Name"}),e.jsx(Ge,{id:"roomName",value:w.name,onChange:l=>S(g=>({...g,name:l.target.value})),placeholder:"Enter room name"})]}),e.jsxs("div",{children:[e.jsx(Le,{htmlFor:"roomType",children:"Room Type"}),e.jsxs(nt,{value:w.type,onValueChange:l=>S(g=>({...g,type:l})),children:[e.jsx(qe,{children:e.jsx(at,{})}),e.jsxs(Je,{children:[e.jsx(Se,{value:"public",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4"}),"Public - Anyone can join"]})}),e.jsx(Se,{value:"private",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Private - Requires room key"]})})]})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(Le,{htmlFor:"maxParticipants",children:"Max Participants"}),e.jsxs(nt,{value:w.maxParticipants.toString(),onValueChange:l=>S(g=>({...g,maxParticipants:parseInt(l)})),children:[e.jsx(qe,{children:e.jsx(at,{})}),e.jsx(Je,{children:[5,10,15,20,25,30].map(l=>e.jsxs(Se,{value:l.toString(),children:[l," participants"]},l))})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx($,{variant:"outline",type:"button",onClick:()=>_(!1),children:"Cancel"}),e.jsx($,{type:"submit",disabled:R||!w.name.trim(),children:R?e.jsxs(e.Fragment,{children:[e.jsx(Bs,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Create Room"]})})]})]})]})})})]})})}function Gr(){const{firebaseUser:t,loading:n}=ve(),s=ye();return a.useEffect(()=>{!n&&!t&&s("/auth")},[t,n,s]),n?e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):t?e.jsxs(ms,{children:[e.jsx(Ne,{path:"/",element:e.jsx(Er,{})}),e.jsx(Ne,{path:"/create-room",element:e.jsx(hs,{})}),e.jsx(Ne,{path:"/join-private-room",element:e.jsx(Tr,{})}),e.jsx(Ne,{path:":roomId",element:e.jsx(Gs,{})})]}):null}export{Tr as JoinPrivateRoomPage,Gr as default};
